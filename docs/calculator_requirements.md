# 📱 계산기 앱 개발 요구사항 문서

## 프로젝트 개요

**목표**: Flutter로 iOS 기준 기본 계산기 수준의 품질을 가진 계산기 앱 만들기

**플랫폼**: iOS 우선, 추후 Android 확장 가능

**개발 기준**: 아이폰 기본 계산기 수준의 퀄리티

---

## 기능 요구사항

### 1. 기본 입력 기능

#### 1.1 숫자 입력 (0-9)
- 초기 상태는 "0"에서 시작
- 선행 0 자동 제거 (예: 05 → 5)
- 최대 12자리 제한 (소수점 제외)
- 숫자 입력 중 실시간 디스플레이 업데이트

#### 1.2 소수점 입력 (.)
- 한 숫자에 소수점은 한 번만 허용
- 숫자 없이 .만 누르면 "0."으로 시작
- 이미 소수점이 있으면 추가 입력 무시
- 소수점 이하 최대 8자리까지 표시

#### 1.3 사칙연산 (+, -, ×, ÷)
- 즉시 실행형 연산 방식 적용
- 연산자 입력 시 이전 계산 자동 실행
- 예: 2 + 3 × 4 = → (2+3)=5, 5×4=20

### 2. 기능 버튼

#### 2.1 AC (All Clear)
- 모든 상태 초기화
- 디스플레이를 "0"으로 리셋
- 이전 값, 연산자, 모든 내부 상태 초기화

#### 2.2 ± (부호 토글)
- 현재 값의 부호를 양수 ↔ 음수 전환
- 0인 경우 변화 없음
- 계산 중간에도 사용 가능

#### 2.3 % (백분율)
- 현재 값을 100으로 나눔
- 예: 50 → 0.5, 200 → 2
- 복잡한 백분율 계산(a + b% 형태)은 구현하지 않음

#### 2.4 = (결과 계산)
- 대기 중인 연산 실행
- 연속 = 입력 지원:
  - 예: 2 + 3 = = = → 5, 8, 11
  - 마지막 연산과 피연산자를 반복 적용

### 3. 연산 방식 (즉시 실행형)

#### 3.1 기본 동작
```
사용자 입력: 2 + 3 × 4 =
내부 동작:
1. 2 입력
2. + 입력 → 2를 previousValue로 저장
3. 3 입력
4. × 입력 → (2 + 3) = 5 계산 실행, 5를 previousValue로 저장
5. 4 입력
6. = 입력 → (5 × 4) = 20 계산 실행
결과: 20
```

#### 3.2 상태 관리
- **currentValue**: 현재 디스플레이 값
- **previousValue**: 이전 계산 값 (연산자 입력 후 저장)
- **pendingOperator**: 대기 중인 연산자
- **lastOperator**: = 연속 입력을 위한 마지막 연산자
- **lastOperand**: = 연속 입력을 위한 마지막 피연산자

### 4. 에러 처리

#### 4.1 0으로 나누기
- 입력: 5 ÷ 0 =
- 결과: "Error" 표시
- 에러 상태에서 숫자 입력 시 자동으로 새 계산 시작
- 에러 상태에서 연산자 입력은 무시

#### 4.2 입력 제한
- 12자리 초과 입력 방지
- 소수점 중복 입력 방지
- 무한대(Infinity), NaN 발생 시 에러 처리

### 5. 특수 시나리오 처리

#### 5.1 = 입력 후 동작
- **숫자 입력**: 새로운 계산 시작
- **연산자 입력**: 이전 결과를 첫 번째 피연산자로 사용
- **= 재입력**: 마지막 연산 반복

#### 5.2 연산자 연속 입력
- 기존 연산자를 새 연산자로 교체
- 예: 5 + - × → 마지막 × 만 적용

---

## 아키텍처 요구사항

### 1. 레이어 구조 (Clean Architecture)

```
lib/
├── domain/          # 비즈니스 로직 (순수 Dart)
├── application/     # 상태 관리
├── presentation/    # UI 레이어
└── core/           # 공통 리소스
```

#### 1.1 Domain Layer
- **순수 Dart 코드**: Flutter에 의존하지 않음
- **테스트 가능**: 단위 테스트 작성 필수
- `calculator_engine.dart`: 모든 계산 로직
- `operator.dart`: 연산자 enum 정의

#### 1.2 Application Layer
- **상태 관리**: Riverpod 또는 Provider 사용
- `calculator_state.dart`: 불변 상태 모델
- `calculator_notifier.dart`: 상태 변경 로직

#### 1.3 Presentation Layer
- **UI 컴포넌트**: Flutter 위젯
- `calculator_page.dart`: 메인 화면
- `calculator_button.dart`: 재사용 가능한 버튼 위젯

#### 1.4 Core Layer
- **디자인 시스템**: 컬러, 타이포그래피, 상수
- `app_colors.dart`: iOS 컬러 팔레트
- `app_text_styles.dart`: 텍스트 스타일
- `app_constants.dart`: 전역 상수

### 2. 상태 관리
- **선택지**: Riverpod(StateNotifier) 또는 Provider(ChangeNotifier)
- **불변성**: 상태는 불변 객체로 관리
- **단방향 데이터 흐름**: UI → Notifier → Engine → State → UI

### 3. 테스트 전략
- **단위 테스트**: calculator_engine.dart 전체 커버리지
- **테스트 케이스**:
  - 기본 사칙연산
  - 즉시 실행형 연산
  - 연속 = 입력
  - 에러 처리 (0으로 나누기)
  - 소수점 처리
  - 부호 토글, 퍼센트
  - AC 동작

---

## UI/UX 요구사항

### 1. 화면 레이아웃

```
┌─────────────────────────┐
│                         │
│    Display Area         │ 35% 높이
│      (우측 정렬)         │
│                         │
├─────────────────────────┤
│                         │
│   Button Grid           │ 65% 높이
│   (4열 × 5행)           │
│                         │
│  [AC] [±] [%] [÷]      │
│  [7]  [8] [9] [×]      │
│  [4]  [5] [6] [−]      │
│  [1]  [2] [3] [+]      │
│  [   0   ] [.] [=]     │ ← 0 버튼 2칸
│                         │
└─────────────────────────┘
```

### 2. 디자인 스펙

#### 2.1 컬러 팔레트 (iOS 스타일)
| 요소 | 배경색 | 텍스트 색 |
|------|--------|----------|
| 앱 배경 | #000000 (검정) | - |
| 디스플레이 | 투명 | #FFFFFF (흰색) |
| 숫자 버튼 | #333333 (진한 회색) | #FFFFFF (흰색) |
| 기능 버튼 | #A5A5A5 (연한 회색) | #000000 (검정) |
| 연산자 버튼 | #FF9F0A (주황색) | #FFFFFF (흰색) |

#### 2.2 타이포그래피
- **디스플레이**: 
  - 최대 96pt, 최소 40pt
  - FontWeight: w200 (얇은 폰트)
  - 자간: -2.0
  - 우측 정렬
- **버튼**:
  - 숫자: 40pt, FontWeight w400
  - 기능: 36pt, FontWeight w500
  - 연산자: 44pt, FontWeight w400

#### 2.3 레이아웃 수치
- 버튼 간격: 12px
- 화면 좌우 패딩: 16px
- 디스플레이 패딩: 32px
- 버튼 그리드 상하 패딩: 24px
- 버튼 형태: 원형 (borderRadius = size / 2)

### 3. 인터랙션

#### 3.1 버튼 애니메이션
- **탭 다운**: 95% 스케일 축소 (100ms)
- **탭 업**: 100% 복원 (150ms)
- **색상 변경**: 탭 시 80% 어둡게
- **애니메이션 곡선**: easeInOut

#### 3.2 햅틱 피드백
- 모든 버튼 탭 시: `HapticFeedback.lightImpact()`
- iOS 네이티브 느낌 재현

#### 3.3 디스플레이 전환
- **애니메이션**: FadeTransition (50ms)
- **폰트 크기**: 텍스트 길이에 따라 자동 조정
- **오버플로우**: 화면 밖으로 나가지 않도록 크기 축소

---

## 코드 품질 요구사항

### 1. 가독성
- 명확한 변수명과 함수명 사용
- 주석으로 복잡한 로직 설명
- 각 파일 상단에 역할 설명 주석 작성

### 2. 유지보수성
- 단일 책임 원칙 (SRP) 준수
- 매직 넘버 사용 금지 (상수로 정의)
- 중복 코드 최소화
- 레이어 간 의존성 명확히 분리

### 3. 테스트 가능성
- Domain Layer는 Flutter 의존성 없이 작성
- 순수 함수 지향
- 사이드 이펙트 최소화
- Mock 가능한 구조

### 4. 성능
- 불필요한 rebuild 방지
- 애니메이션 최적화
- 메모리 누수 방지 (dispose 구현)

---

## 개발 우선순위

### Phase 1: 핵심 기능 (MVP)
1. ✅ Domain Layer 구현
   - operator.dart
   - calculator_engine.dart
   - 단위 테스트
2. ✅ Application Layer 구현
   - calculator_state.dart
   - calculator_notifier.dart
3. ✅ Core Layer 구현
   - app_colors.dart
   - app_text_styles.dart
   - app_constants.dart
4. ✅ Presentation Layer 구현
   - calculator_button.dart
   - calculator_page.dart
   - main.dart

### Phase 2: 개선 (향후)
- [ ] C 버튼 추가 (현재 입력만 지우기)
- [ ] 다크 모드 완전 지원
- [ ] 과학 계산기 모드
- [ ] 계산 히스토리
- [ ] 커스텀 폰트 적용 (SF Pro Display)
- [ ] 가로 모드 지원
- [ ] Widget 테스트 추가

---

## 제약사항 및 전제조건

### 1. 기술 스택
- Flutter SDK: 3.0.0 이상
- Dart: 3.0.0 이상
- Riverpod: 2.4.0 이상

### 2. 지원 플랫폼
- iOS: 14.0 이상 (우선)
- Android: API 21 이상 (향후)

### 3. 화면 방향
- **세로 모드만 지원** (iOS 계산기와 동일)
- 가로 모드는 Phase 2에서 고려

### 4. 접근성
- 현재는 고려하지 않음
- Phase 2에서 추가 예정

---

## 참고 자료

### iOS 계산기 동작 연구
- 즉시 실행형 연산 방식
- 연속 = 버튼 동작
- 에러 처리 방식
- UI/UX 디테일

### Flutter 베스트 프랙티스
- Clean Architecture
- Riverpod 상태 관리
- 반응형 UI 디자인
- 테스트 전략

---

**문서 버전**: 1.0
**최종 수정일**: 2025-12-06
**작성자**: 프로젝트 기획팀